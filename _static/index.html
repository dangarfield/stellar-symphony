<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Stellar Symphony</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.0.7/dist/css/splide.min.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300&display=swap" rel="stylesheet">

    <style>
        body {
            background-color: black;
            color: white;
            font-family: 'Space Grotesk', sans-serif;
        }

        .logo {
            color: white;
            width: 60px;
            height: 40px;
            object-fit: cover;
        }

        .title {
            font-size: 20px;
            padding-left: 10px;
        }

        .tone-clip {
            font-style: normal;
        }

        .tone-clip:hover,
        .tone-stop:hover {
            cursor: pointer;
        }

        .star-map,
        .icon-holders {
            position: fixed;
            top: 0;
            left: 0;
            outline: none;
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
        }

        .star-map .label {
            color: #FFF;
            padding: 2px;
            background: rgba(0, 0, 0, .6);
        }

        .star-map .label-note {
            color: #FFF;
            padding: 2px;
            background: rgba(0, 0, 0, 0.5);
            opacity: 0.5;
        }

        .constellation-select {
            width: 220px;
            color: white;
            background-color: rgba(0, 0, 0, 0.7);
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='white' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m2 5 6 6 6-6'/%3e%3c/svg%3e")
        }

        .info-long-instrument-select {
            color: white;
            background-color: rgba(0, 0, 0, 0.7);
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='white' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m2 5 6 6 6-6'/%3e%3c/svg%3e")
        }

        .info-short,
        .tone-stop {
            display: none;
        }

        .info-long,
        .info-full {
            background: rgba(0, 0, 0, 0.7);
            position: absolute;
            top: 48px;
            /* Change top to 130px for mobiles */
            left: 0px;
            width: 380px;
            max-width: calc(100vw - 12px);
            margin: 6px;
            min-height: 200px;
            max-height: calc(100vh - 123px);
            /* Change max-height to 190px for mobiles */
            border-radius: .375rem;
            border: 1px solid #ced4da;
            display: none;
        }

        .info-long {
            width: 380px;
            max-width: calc(100vw - 12px);
        }

        .info-full {
            width: calc(100vw - 12px);
        }

        .modal-content .btn-close {
            background: transparent url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23000'%3e%3cpath d='M.293.293a1 1 0 0 1 1.414 0L8 6.586 14.293.293a1 1 0 1 1 1.414 1.414L9.414 8l6.293 6.293a1 1 0 0 1-1.414 1.414L8 9.414l-6.293 6.293a1 1 0 0 1-1.414-1.414L6.586 8 .293 1.707a1 1 0 0 1 0-1.414z'/%3e%3c/svg%3e") center/1em auto no-repeat;
        }

        .close {
            font-size: 20px;
        }

        .close:hover {
            cursor: pointer;
        }

        .action-links i {
            font-size: 40px;
            padding: 0 10px;
            color: #6c757d;
        }

        .action-links .action-bg {
            background-color: rgba(0, 0, 0, 0.6);
            display: inline-block;
        }

        .action-links i:hover {
            cursor: pointer;
        }


        .action-links i.active {
            color: white;
        }

        .action-play.bi-stop-btn.active {
            background: linear-gradient(-45deg, #FF00FF, #FF00FF, #1363DF, #1363DF);
            background-size: 300%;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: animated_text 10s ease-in-out infinite;
            -moz-animation: animated_text 10s ease-in-out infinite;
            -webkit-animation: animated_text 10s ease-in-out infinite;
        }

        .action-play.bi-stop-btn.active .tooltip-text {
            background: rgba(0, 0, 0, 0.6);
            background-size: 100%;
            color: white;
            background-clip: none;
            -webkit-background-clip: none;
            -webkit-text-fill-color: white;
            animation: none;
            -moz-animation: none;
            -webkit-animation: none;
        }


        @keyframes animated_text {
            0% {
                background-position: 0px 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0px 50%;
            }
        }


        .info-long,
        .info-full {
            flex-direction: column;
        }

        .info-body-parent {
            overflow-y: auto;
            overflow-x: hidden;
            flex: 1;
        }

        .info-body {
            flex-direction: row;
        }

        /* Small scrollbars */
        ::-webkit-scrollbar {
            width: 7px;
            padding-left: 5px;
        }

        ::-webkit-scrollbar-track {
            box-shadow: inset 0 0 2px grey;
            border-radius: 5px;
            padding-left: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: white;
            border-radius: 5px;
            padding-left: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: grey;
            padding-left: 5px;
        }

        .tooltip-parent {
            position: relative;
            display: inline-block;
        }

        .tooltip-parent .tooltip-text {
            visibility: hidden;
            width: 160px;
            background-color: rgba(0, 0, 0, 0.6);
            color: #fff;
            text-align: center;
            padding: 5px 0;
            border-radius: 6px;

            position: absolute;
            z-index: 1;
            bottom: 100%;
            left: 50%;
            margin-left: -80px;
            font-size: 16px;
            font-style: normal;
        }

        .tooltip-parent:hover .tooltip-text {
            visibility: visible;
        }

        .tooltip-parent:hover .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: rgba(0, 0, 0, 0.6) transparent transparent transparent;
        }

        .ldBar-label {
            font-size: 1.25rem;
        }

        .ldBar-label:after {
            content: " %";
        }

        .ldBar path.baseline,
        .ldBar path.mainline {
            stroke-linecap: round;
        }

        .loading {
            background: rgba(0, 0, 0, 0.6);
            padding: 50px;
            border-radius: 10px;
        }

        .slide-image {
            max-height: 400px;
            object-fit: contain;
        }

        .explanation-progress {
            background: #888;
        }

        .explanation-progress-bar {
            background: white;
            height: 2px;
            transition: width 400ms ease;
            width: 0;
        }

        .explanation .nav-pills .nav-link {
            padding: 8px 4px;
        }

        .explanation .nav-pills .nav-link:not(.active) {
            background: 0;
            color: white;
        }

        .explanation .nav-pills .nav-link.active {
            background-color: white;
            color: black;
        }

        .loading .blockquote-footer {
            margin: 0;
        }

        @media (max-width: 576px) {
            .explanation .nav-pills .nav-link {
                padding: 4px;
            }

            .constellation-select {
                width: 100%;
                margin-top: 5px;
            }

            .p-2 {
                padding: 6px !important;
            }

            .info-long,
            .info-full {
                top: 90px;
                max-height: calc(100vh - 260px);
            }

            .action-links i {
                font-size: 30px;
                padding: 0 3px;
            }

            .loading.translate-middle {
                transform: translate(-0%, -50%) !important;
            }

            .loading.start-50 {
                left: 0% !important;
            }
        }
    </style>
</head>

<body>


    <header class="fixed-top">
        <nav class="d-flex w-100 p-2 justify-content-between flex-column flex-sm-row">
            <div class="text-center">
                <img src="orbit.svg" class="logo">
                <span class="navbar-text title">Stellar Symphony</span>
            </div>
            <div class="navbar-text text-center info-short">
                <span class="name">Constellation</span> -
                <i class="bi bi-play-circle tone-clip"></i>
                <i class="bi bi-stop-circle tone-stop"></i>
            </div>
            <select class="form-select constellation-select">
                <option style="display:none" value="">Select constellation</option>
            </select>
        </nav>
    </header>
    <div class="stats"></div>
    <div class="icon-holders">
        <div class="star-map"></div>
        <div class="loading position-absolute top-50 start-50 translate-middle">
            <div class="quote" style="display: none;">
                <blockquote class="blockquote text-center">
                    <p class="mb-0">And sometimes instead of these innocent souls he only thinks of the girl who was named after the Moon</p>
                    <footer class="blockquote-footer">Dan</footer>
                </blockquote>
                <hr />
            </div>
            <h3 class="loading-text text-center">Loading...</h3>
            <div class="ld-bar text-center" style="width:100%;height:60px" data-stroke="data:ldbar/res,gradient(0,1,#FF00FF, #1363DF)" data-path="M10 20Q20 15 30 20Q40 25 50 20Q60 15 70 20Q80 25 90 20" data-value="0">
            </div>

        </div>
        <div class="info-long container-fluid">
            <div class="row">
                <div class="col-12">
                    <div class="d-flex justify-content-between">
                        <h5 class="name pt-1">Constellation</h5>
                        <i class="bi bi-x-lg close"></i>
                    </div>
                </div>
            </div>
            <div class="row">
                <hr />
            </div>
            <div class="row info-body-parent">
                <div class="col-12 info-body">
                </div>
            </div>
        </div>
        <div class="info-full container-fluid">
            <div class="row">
                <div class="col-12">
                    <div class="d-flex justify-content-between">
                        <h5 class="name pt-1">Constellation</h5>
                        <i class="bi bi-x-lg close"></i>
                    </div>
                </div>
            </div>
            <div class="row">
                <hr />
            </div>
            <div class="row info-body-parent">
                <div class="info-body">
                </div>
            </div>
        </div>
    </div>
    <footer class="fixed-bottom">
        <nav class="w-100 text-center">
            <div class="navbar-text action-links">
                <span class="action-bg"><i class="bi bi-play-btn action-play tooltip-parent tone-clip"><span class="tooltip-text">Play</span></i></span>
                <span class="action-bg"><i class="bi bi-info-circle action-info tooltip-parent"><span class="tooltip-text">Constellation Info</span></i></span>
                <span class="action-bg"><i class="bi bi-bar-chart-line action-graph-all tooltip-parent"><span class="tooltip-text">All constellation analysis</span></i></span>
                <span class="action-bg"><i class="bi bi-graph-up action-graph-one tooltip-parent"><span class="tooltip-text">One constellation analysis</span></i></span>
                <span class="action-bg"><i class="bi bi-chat-quote action-explain tooltip-parent"><span class="tooltip-text">Detailed explanation</span></i></span>
                <span class="action-bg"><i class="bi bi-stars action-all-stars tooltip-parent active"><span class="tooltip-text">Show / Hide stars for performance</span></i></span>
            </div>
        </nav>
    </footer>

    <template id="explanation">
        <div class="explanation">
            <ul class="nav nav-pills nav-fill mb-3">
                <li class="nav-item"><button type="button" class="nav-link active" data-heading="why">Why?</button></li>
                <li class="nav-item"><button type="button" class="nav-link" data-heading="data">Data</button></li>
                <li class="nav-item"><button type="button" class="nav-link" data-heading="scale">Scale</button></li>
                <li class="nav-item"><button type="button" class="nav-link" data-heading="chords">Chords</button></li>
                <li class="nav-item"><button type="button" class="nav-link" data-heading="melody">Melody</button></li>
                <li class="nav-item"><button type="button" class="nav-link" data-heading="instruments">Instruments</button></li>
                <li class="nav-item"><button type="button" class="nav-link" data-heading="tempo">Tempo</button></li>
                <li class="nav-item"><button type="button" class="nav-link" data-heading="structure">Structure</button></li>
                <li class="nav-item"><button type="button" class="nav-link" data-heading="starmap">Starmap</button></li>
            </ul>

            <section class="splide" aria-label="Splide Basic HTML Example">
                <div class="explanation-progress mb-3">
                    <div class="explanation-progress-bar"></div>
                </div>

                <div class="splide__track">
                    <ul class="splide__list">
                        <li class="splide__slide" data-heading="why">
                            <!-- <img src="https://picsum.photos/id/100/800/400" class="w-100 mb-3 slide-image" /> -->
                            <!-- <h5>Why?</h5> -->
                            <p>
                                What do the stars sound like? Can we construct songs music purely referencing a single set of rules that we can apply to all
                                star data that we have to create some patterns and music from them?
                            </p>
                            <p>
                                I'm Dan and this is what I've been working at achieving.
                            </p>
                        </li>
                        <li class="splide__slide" data-heading="data">
                            <!-- <img src="https://picsum.photos/id/101/800/400" class="w-100 mb-3 slide-image" /> -->
                            <!-- <h5>Data</h5> -->
                            <p>
                                We know surprisingly little about the stars around, but we do have publicly available data for about 120000 stars in our galaxy.
                                Each of these stars are plotted in the star map with the differences in visible magnitude (how bright they are us) shown by bigger, brighter dots.
                            </p>
                            <p>
                                Imagine comparing the brightness of each star. That's pretty hard because there are so many and the brightness are are all pretty different.
                                One way would be to imagine the brightest star and the dullest star, now imagine creating a number of buckets or groups that you could put
                                the stars in, eg, a brightness of 1.5 might fit into the bucket 1 to 2.
                                In this experiment, I've created 24 buckets for each of the different pieces of indignation we have of the stars:
                            </p>
                            <ul>
                                <li>Absolute magnitude (how bright the star really is)</li>
                                <li>Relative magnitude (how bright the star appears from earth)</li>
                                <li>Luminosity (the colour, closely representing the temperature of the star)</li>
                                <li>etc</li>
                            </ul>
                            <p>
                                Once we have these buckets, we can start to group them for each constellation of stars. Some constellations may have more bright stars, or hotter stars.
                                Funnily enough, it starts to look like an musical EQ curve. We can also take the average of all stars and compare the constellations to those averages.
                                This is ultimately how I've created the rules the crate the music, by identifying differences between the constellations and making them into
                                rules to apply to create scales, chords, melodies and instruments for these pieces. All without my involvement out without me writing any music.
                            </p>
                        </li>
                        <li class="splide__slide" data-heading="scale">
                            <!-- <img src="https://picsum.photos/id/102/800/400" class="w-100 mb-3 slide-image" /> -->
                            <!-- <h5>Scale</h5> -->
                            <p>
                                We can plot the differences of absolute magnitude from the whole average star data.
                            </p>
                            <p>
                                If we look at one particular constellation (let's take Aquarius), we can see that I some case some of the buckets are bigger or smaller than the average.
                                This means that Aquarius has a few more 0.3 to 0.4 stars that the average of all data.
                            </p>
                            <p>
                                The are 12 potential notes in a scale (e.g., C, C#, D, D#, E, F, F#, G, G#, A, A#, B - all of the black and white keys on a piano).
                                Most (normal scales) have 7 notes, e.g., the major scale (the happy scale) is C, D, E, F, G, A, B.
                                Wouldn't it be cool if we could compare eachof the constellations so that it might point towards a different scale?
                            </p>
                            <p>
                                Well, let's look a look at the buckets of absolute magnitude differences in Aquarius.
                                Let's take the 6 most extreme values, eg biggest differences from the averages, it could be big or small. For each of these we count say that
                                if the difference was positive (Aquarius had more on average in this bucket), the it could be a black (e.g., D#).
                                If it was negative, it could be a white note (e.g., D). In fact, there are a few nuances to this, but this is what I've done.
                                I then compare this to the 20 typical scales that are used in western music. The closest match is the one scale that is used for everything in this constellation.
                                This gives each scale a audial difference. Some are happy (generally a major key, or had some major elements in it),
                                some are sad or moody (minor), or some are just plain strange (using scales that aren't typically used in our pop or rock music).
                            </p>
                            <p>
                                This is the frequency of scales and how many are used in all constellations.
                            </p>
                        </li>
                        <li class="splide__slide" data-heading="chords">
                            <!-- <img src="https://picsum.photos/id/103/800/400" class="w-100 mb-3 slide-image" /> -->
                            <!-- <h5>Chords</h5> -->
                            <p>
                                Most pop music is made from chords, and these chords are normally made from a root note as part of a triad.
                            </p>
                            <p>
                                What does that mean? Let's take C major (C, D, E, F, G, A, B). A triad is made of 3 notes, most typically 2 notes in the scale away from each other,
                                e.g. the first one is C, E, G (a C major chord). The second D, F, A (a D minor chord) etc etc.
                                As there 7 notes, there are 7 different starting points for each triad.
                            </p>
                            <p>
                                Fine, but how can we choose since chords from each constellation? In the same way we took the differences in absolute magnitude for
                                each conversion to produce the scale, why not use the relative magnitude to choose the chords?
                                Let's choose a range of 4 buckets to compare, grouping them off how they differ with the least different using the first triad C, and the most different using B.
                                Additionally, we can add some extra notes that add a little dramatic flavour if they are negative (add9, add11, add13).
                                Remember, these aren't always major chords, they use the scale that we have already selected.</p>
                            </p>
                        </li>
                        <li class="splide__slide" data-heading="melody">
                            <!-- <img src="https://picsum.photos/id/104/800/400" class="w-100 mb-3 slide-image" /> -->
                            <!-- <h5>Melody</h5> -->
                            <p>
                                Each constellation had a number of main stars, typically illustrated by points if you draw the constellation. I wanted to use these main stars to play a melody.
                                In fact, I wanted 2 melodies.
                            </p>
                            <p>There are 2 aspects, the rhythm or timing of the melody and the specific notes that are played.
                                The first melody uses the position of the main stars (relative to us here on earth) to select the notes from the scale and the distance away from the main star (alpha star) of the constellation for the timing.
                            </p>
                            <p>
                                You can see that we can divide a circle in 14 parts where each half contains the 7 notes of our scale. Looking at a long thin constellation,
                                using this method, it actually has lots of the same notes, that sounds quite interesting.
                            </p>
                            <p>
                                Also, the timing of the notes is based on the distance from the alpha star, as represented by the expanding purple circle.
                                Some constellations with only a few stars (5 or less) are repeated twice as often, just to fill the space a little more.
                            </p>
                            <p>
                                For the second melody, we do the opposite. The rhythm is made from the position of the main stars relative to the visual centre,
                                and the note is made from the distance of the star to the centre of the constellation.
                                We can see that some 'square' constellations appear to have consistent timing and also very similar notes.
                                This level of regularity or irregularity translates into audio differences.
                            </p>
                            <!-- <p>
                                TODO - High notes, picking and arpeggio
                            </p> -->
                        </li>
                        <li class="splide__slide" data-heading="instruments">
                            <!-- <img src="https://picsum.photos/id/106/800/400" class="w-100 mb-3 slide-image" /> -->
                            <!-- <h5>Instruments</h5> -->
                            <p>
                                I have cheated a little here. I was originally wanting to create soundscapes based on the actual frequencies off the known stars,
                                but very little of this data is available, and certainly not for the 100000 stars that I wanted.
                                Instead, I created a list of instruments, suitable for each party of the track and ordered them by soft to hard sound.
                                Looking at the luminosity buckets, I then ordered all constellations by these values and allocated the least frequently luminous
                                to the soft sounds and the most frequently luminous to the harder sounds.
                            </p>
                            <p>
                                All constellations have been recording properly in music software using the exact same samples: <b>Play full band</b>, however, you can change them
                                and play use the <b>Play with real time Instruments</b> to play with sampled instruments directly in the browser.
                            </p>
                        </li>
                        <li class="splide__slide" data-heading="tempo">
                            <!-- <img src="https://picsum.photos/id/107/800/400" class="w-100 mb-3 slide-image" /> -->
                            <!-- <h5>Tempo</h5> -->
                            <p>
                                I was going to add tempo based on the average revolution speel of the stars, however, there is relatively little date known in the hyg
                                data sets for this, and also in order for me to be able to use real time instrument changes, the recorded notes (and drum samples)
                                were much easier to record at one single tempo, so all are at 80 bpm.
                            </p>
                        </li>
                        <li class="splide__slide" data-heading="structure">
                            <!-- <img src="https://picsum.photos/id/108/800/400" class="w-100 mb-3 slide-image" /> -->
                            <!-- <h5>Structure</h5> -->
                            <p>
                                Plotting the relative magnitude differences, we can see that there is a little shopping structure emerging.
                                I chose to use 9 to 15 to start sparsely, the gradually build up the instruments, have a small lull towards the end, the final crescendo.
                            </p>
                        </li>
                        <li class="splide__slide" data-heading="starmap">
                            <!-- <img src="https://picsum.photos/id/109/800/400" class="w-100 mb-3 slide-image" /> -->
                            <!-- <h5>Starmap</h5> -->
                            <p>
                                All 120000 stars are plotted and the view can be moved around, each time the focus changes of a constellation changes on the map,
                                the information panel is updated. Here, you can play the songs, or directly from the <b>play</b> icon at the bottom of the screen.
                            </p>
                        </li>
                    </ul>
                </div>

            </section>
        </div>
    </template>
    <script src="client.min.js"></script>

</body>

</html>